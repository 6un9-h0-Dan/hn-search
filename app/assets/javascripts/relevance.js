!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.harvest=e()}(this,function(){"use strict";function t(t,e,i){var n=new Date;n.setTime(n.getTime()+24*i*60*60*1e3);var o="expires="+n.toUTCString();document.cookie=t+"="+e+";"+o+";path=/"}function e(t){for(var e=t+"=",i=decodeURIComponent(document.cookie).split(";"),n=0;n<i.length;n++){for(var o=i[n];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(e))return o.substring(e.length,o.length)}return""}var i=function(t){return"string"==typeof t?document.querySelector(t)||new Error(t+" is not a valid DOM selector"):!(!t||!t.tagName)&&t},n=function(t){return{inputNode:i(t)}},o=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})},r=o,s=function(){var i=e("HAR_ID");if(i&&""!==i)return t("HAR_ID",i,10),i;var n=o();return t("HAR_ID",n,10),n},a=function(t){void 0===t&&(t={}),this.indexName=t.indexName,this.queryID="",this.userID=s(),this.sessionID=r(),this.searchResults=[],this.typingTimeToConfirmed=0===t.timeoutTime?0:t.timeoutTime||1200,this.currentQuery="",this.previousQuery="",this.clickedObjectID=null,this.applicationID=t.applicationID||"",this.indexName=t.indexName||"",this.initialiseCustomEvent=!1,this.clickedNodePosition=null,this.clickedContainerID=null,this.considerViewedResults=!1,this.didMoveMouseAfterQuery=null,this.navigatedWithoutClicking=!1},c=function(t,e,i){"function"==typeof t.addEventListener?t.addEventListener(e,i):"function"==typeof t.attachEvent&&t.attachEvent(e,i)},u=function(){var t=this;this.previousQuery=this.currentQuery,this.currentQuery=this.inputNode.value||"",this.endedTypingTimeoutID&&window.clearTimeout(this.endedTypingTimeoutID),""!==this.currentQuery&&(this.endedTypingTimeoutID=setTimeout(function(){t.considerViewedResults=!0},this.typingTimeToConfirmed)),this.createReport("search")},d=function(t){var e={event:t,position:this.clickedNodePosition,query:this.currentQuery,userID:this.userID,sessionID:this.sessionID,timestamp:Date.now(),index:"string"==typeof this.indexName?this.indexName:"function"==typeof this.indexName?this.indexName():""};"click"===t&&(e.queryID=this.queryID),this.searchState&&"function"==typeof this.searchState&&"search"===t&&(e.queryParameters=this.searchState()),this.initialiseCustomEvent||this.sendReport(e,t)},h=function(t,e){var i=this;void 0===e&&(e="search"),this.resetState();var n=JSON.stringify(t),o="https://harvest.algolia.com/1/"+e,r=new XMLHttpRequest;r.open("POST",o,"click"!==e),r.setRequestHeader("Content-Type","application/json"),r.setRequestHeader("X-Algolia-API-Key","3fc385cecae0693e0482dc9698d4d66896e7090a5bcdbe00ce63e89abbfc80ff"),r.setRequestHeader("X-Algolia-Application-Id","UJ5WYC0L7X"),r.onreadystatechange=function(){if(4===r.readyState){var t=JSON.parse(r.responseText)||{};200===r.status&&"search"===e&&t.queryID&&(i.queryID=t.queryID)}},r.send(n)},l=function(t,e,i){var n=this;this.initialiseCustomEvent=!0,setTimeout(function(){var o={event:t,eventValue:e,position:n.clickedNodePosition,hitsContainerID:n.clickedContainerID,query:n.currentQuery,indexName:n.indexName,applicationID:n.applicationID,UUID:n.UUID},r=Object.assign({},o,i);n.sendReport(r)},0)},p=function(){this.initialiseCustomEvent=!1,this.considerViewedResults=!1,this.navigatedWithoutClicking=!1,this.clickedObjectID=null,this.clickedNodePosition=null,this.clickedContainerID=null},f=function(t,e,i,n){return this.navigatedWithoutClicking=!1,Array.prototype.slice.call(e.querySelectorAll("[data-algolia-objectid]")).indexOf(t)+1},y=function(t,e){for(var i=t;i.parentNode;){var n=i.getAttribute("data-algolia-hitscontainer");if(n)return{clickedContainer:i,containerID:n};i=i.parentNode}},v=function(t){for(var e=t&&t.target?t.target:null;e.parentNode;){var i=e.getAttribute("data-algolia-objectid");if(i)return{clickedHit:e,hitID:i};e=e.parentNode}};"function"!=typeof Object.assign&&(Object.assign=function(t,e){var i=arguments;if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(t),o=1;o<arguments.length;o++){var r=i[o];if(null!=r)for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(n[s]=r[s])}return n});var x=function(t){void 0===t&&(t={}),this.options=t||{},this.bindSettings=a.bind(this),this.storeQuery=u.bind(this),this.didClickOnResults=v.bind(this),this.createReport=d.bind(this),this.resetState=p.bind(this),this.onHitNodeMatch=f.bind(this),this.sendReport=h.bind(this),this.getHitsContainer=y.bind(this),this.customEvent=l.bind(this),this.bindSettings(t),this.initSearch=this.initSearch.bind(this),this.endedTypingTimeoutID=null,window.harvest=this};return x.prototype.initSearch=function(t,e){var i=this,o=n(t);this.inputNode=o.inputNode,e&&"function"==typeof e&&(this.searchState=e),this.inputNode&&(c(this.inputNode,"input",this.storeQuery),this.storeQuery(),c(document,"click",function(t){var e,n=i.didClickOnResults(t);if(n&&(e=i.getHitsContainer(n.clickedHit,n.hitID)),e&&n){var o=i.onHitNodeMatch(n.clickedHit,e.clickedContainer,n.hitID,e.containerID);i.clickedNodePosition=o,i.clickedObjectID=n.hitID,i.clickedContainerID=e.containerID,i.createReport("click")}}))},function(t){var e=function(){for(var e=[],i=arguments.length;i--;)e[i]=arguments[i];return new(Function.prototype.bind.apply(t,[null].concat(e)))};return e.__proto__=t,e.prototype=t.prototype,e}(x)});
